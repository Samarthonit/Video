<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Run For Girl Child</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      margin: 0; padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background-color: #1f1f1f;
      color: white;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: 0;
      overflow: hidden;
    }

    .container {
      width: 100%;
      max-width: 100%;
      text-align: center;
      display: flex;
      flex-direction: column;
      height: 100vh;
      padding: 0;
    }

    h1 {
      margin: 8px 0;
      font-size: 1.4rem;
      color: #ff6b6b;
      flex-shrink: 0;
      padding: 0 10px;
    }

    .recorder-container {
      position: relative;
      width: 100%;
      flex: 1;
      overflow: hidden;
      background-color: #000;
      margin: 0;
      min-height: 0; /* Important for flex child */
    }

    #frame {
      width: 100%;
      height: 100%;
      object-fit: contain;
      display: block;
    }

    #webcam {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    #canvas {
      display: none;
    }

    /* Webcam area */
    .webcam-area {
      position: absolute;
      top: 25%;
      left: 10%;
      width: 80%;
      height: 45%;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 0 0 2px rgba(255, 107, 107, 0.5);
    }

    .webcam-feed {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .controls-section {
      flex-shrink: 0;
      padding: 8px;
      background: #1f1f1f;
    }

    .timer-container {
      margin: 8px 0;
      font-size: 1.1rem;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      background: rgba(255, 255, 255, 0.1);
      padding: 10px 15px;
      border-radius: 20px;
    }

    .recording-indicator {
      display: inline-block;
      width: 10px;
      height: 10px;
      background-color: #f44336;
      border-radius: 50%;
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(0.8); opacity: 0.7; }
      50% { transform: scale(1.1); opacity: 1; }
      100% { transform: scale(0.8); opacity: 0.7; }
    }

    .controls {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin: 8px 0;
    }

    .btn {
      padding: 12px 8px;
      border: none;
      border-radius: 25px;
      font-size: 0.8rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 4px;
      min-height: 55px;
    }

    .btn i {
      font-size: 1rem;
    }

    .btn-text {
      font-size: 0.75rem;
    }

    .btn-start { background: linear-gradient(45deg, #4CAF50, #45a049); color: white; }
    .btn-stop { background: linear-gradient(45deg, #f44336, #d32f2f); color: white; }
    .btn-download { background: linear-gradient(45deg, #2196F3, #1976d2); color: white; }
    .btn-share { background: linear-gradient(45deg, #9C27B0, #7b1fa2); color: white; }

    .btn:active { transform: scale(0.95); }
    .btn:disabled { background: #555; cursor: not-allowed; transform: none; }

    .status {
      margin: 8px 0;
      padding: 10px;
      border-radius: 8px;
      background: linear-gradient(45deg, rgba(255, 107, 107, 0.2), rgba(255, 193, 7, 0.2));
      font-size: 0.8rem;
      border-left: 3px solid #ff6b6b;
      flex-shrink: 0;
    }

    .download-notification {
      position: fixed;
      top: 10px;
      right: 10px;
      background: linear-gradient(45deg, #4CAF50, #45a049);
      color: white;
      padding: 8px 12px;
      border-radius: 8px;
      display: none;
      animation: slideIn .3s ease;
      z-index: 1000;
      box-shadow: 0 3px 10px rgba(0,0,0,0.3);
      font-size: 0.8rem;
    }

    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    /* ===== LAPTOP/DESKTOP STYLES ===== */
    @media (min-width: 768px) {
      body {
        padding: 20px;
        justify-content: center;
        overflow: auto;
        background: linear-gradient(135deg, #1a1a2e, #16213e);
        min-height: 100vh;
        height: auto;
      }

      .container {
        max-width: 95vw;
        height: auto;
        min-height: 85vh;
        flex-direction: row;
        gap: 30px;
        align-items: center;
        justify-content: center;
        padding: 20px;
        margin: 0 auto;
      }

      h1 {
        position: absolute;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 2.2rem;
        margin: 0;
        white-space: nowrap;
      }

      .recorder-container {
        flex: 1;
        max-width: 500px;
        min-height: 500px;
        max-height: 70vh;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        margin: 0;
      }

      .controls-section {
        flex: 0 0 350px;
        padding: 30px 25px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        backdrop-filter: blur(10px);
        height: fit-content;
        max-height: 500px;
      }

      .timer-container {
        font-size: 1.6rem;
        padding: 18px;
        border-radius: 25px;
        border: 2px solid #ff6b6b;
        margin-bottom: 20px;
      }

      .recording-indicator {
        width: 14px;
        height: 14px;
      }

      .controls {
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin: 20px 0;
      }

      .btn {
        padding: 18px 12px;
        font-size: 0.9rem;
        min-height: 75px;
        border-radius: 30px;
        gap: 6px;
      }

      .btn i {
        font-size: 1.3rem;
      }

      .btn-text {
        font-size: 0.85rem;
      }

      .btn:hover { 
        transform: translateY(-3px); 
        box-shadow: 0 6px 20px rgba(0,0,0,0.3); 
      }
      .btn:active { transform: translateY(-1px); }

      .status {
        padding: 12px;
        font-size: 0.9rem;
        border-left: 4px solid #ff6b6b;
        margin-top: 15px;
      }

      .download-notification {
        top: 20px;
        right: 20px;
        padding: 12px 18px;
        font-size: 0.9rem;
      }

      /* Webcam area adjustments for desktop */
      .webcam-area {
        border-radius: 10px;
        box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.5);
      }
    }

    /* Medium desktop/laptop */
    @media (min-width: 768px) and (max-width: 1024px) {
      .container {
        max-width: 90vw;
        gap: 25px;
      }
      
      .recorder-container {
        max-width: 450px;
        min-height: 450px;
      }
      
      .controls-section {
        flex: 0 0 320px;
        padding: 25px 20px;
      }
      
      .btn {
        padding: 16px 10px;
        min-height: 70px;
      }
    }

    /* Large desktop screens */
    @media (min-width: 1200px) {
      .container {
        max-width: 1100px;
      }
      
      .recorder-container {
        max-width: 550px;
        min-height: 550px;
      }
      
      .controls-section {
        flex: 0 0 380px;
        padding: 35px 30px;
      }
      
      .btn {
        padding: 20px 15px;
        min-height: 85px;
      }
      
      .btn i {
        font-size: 1.4rem;
      }
      
      .btn-text {
        font-size: 0.9rem;
      }
    }

    /* Very small laptop screens */
    @media (min-width: 768px) and (max-height: 700px) {
      .container {
        min-height: 90vh;
        max-height: 90vh;
      }
      
      .recorder-container {
        max-height: 60vh;
        min-height: 400px;
      }
      
      .controls-section {
        max-height: 450px;
      }
      
      .btn {
        padding: 14px 10px;
        min-height: 65px;
      }
    }

    /* Hide title on very small mobile screens */
    @media (max-height: 600px) and (max-width: 767px) {
      h1 {
        display: none;
      }
      .controls-section {
        padding: 5px;
      }
    }

    /* Adjust webcam area for very small mobile screens */
    @media (max-width: 380px) {
      .webcam-area {
        top: 23%;
        height: 47%;
      }
      .btn {
        padding: 10px 5px;
        min-height: 50px;
      }
      .btn-text {
        font-size: 0.7rem;
      }
    }

    /* Fix for very small laptop screens in portrait */
    @media (max-height: 600px) and (min-width: 768px) {
      body {
        padding: 10px;
      }
      
      .container {
        min-height: 95vh;
        max-height: 95vh;
      }
      
      .recorder-container {
        min-height: 350px;
        max-height: 50vh;
      }
      
      .controls-section {
        padding: 20px 15px;
      }
      
      .btn {
        padding: 12px 8px;
        min-height: 60px;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>Run For Girl Child</h1>

    <div class="recorder-container">
      <img id="frame" src="frame.png" alt="Run For Girl Child Frame" />
      
      <div class="webcam-area">
        <video id="webcam" class="webcam-feed" autoplay muted playsinline></video>
      </div>
      
      <canvas id="canvas"></canvas>
    </div>

    <div class="controls-section">
      <div class="timer-container">
        <span id="timer">00:00:00</span>
        <div id="recordingIndicator" class="recording-indicator" style="display:none;"></div>
      </div>

      <div class="controls">
        <button id="startBtn" class="btn btn-start">
          <i class="fas fa-record-vinyl"></i>
          <span class="btn-text">Start</span>
        </button>
        <button id="stopBtn" class="btn btn-stop" disabled>
          <i class="fas fa-stop"></i>
          <span class="btn-text">Stop</span>
        </button>
        <button id="downloadBtn" class="btn btn-download" disabled>
          <i class="fas fa-download"></i>
          <span class="btn-text">Download</span>
        </button>
        <button id="shareBtn" class="btn btn-share" disabled>
          <i class="fas fa-share-alt"></i>
          <span class="btn-text">Share</span>
        </button>
      </div>

      <div id="status" class="status">Click "Start" to begin recording</div>
    </div>
  </div>

  <div id="downloadNotification" class="download-notification">
    <i class="fas fa-check-circle"></i> Downloaded!
  </div>

  <script>
    const webcam = document.getElementById('webcam');
    const frame = document.getElementById('frame');
    const canvas = document.getElementById('canvas');
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const downloadBtn = document.getElementById('downloadBtn');
    const shareBtn = document.getElementById('shareBtn');
    const timer = document.getElementById('timer');
    const recordingIndicator = document.getElementById('recordingIndicator');
    const status = document.getElementById('status');
    const downloadNotification = document.getElementById('downloadNotification');

    let mediaRecorder, recordedChunks = [], stream = null, recordingBlob = null, timerInterval;
    let seconds = 0, minutes = 0, hours = 0;

    // Function to check for MP4 support
    function getSupportedMimeType() {
      const types = [
        'video/mp4; codecs="avc1.42E01E, mp4a.40.2"',
        'video/webm; codecs="vp9,opus"',
        'video/webm; codecs="vp8,opus"',
        'video/webm'
      ];
      
      for (let type of types) {
        if (MediaRecorder.isTypeSupported(type)) {
          return type;
        }
      }
      return 'video/webm';
    }

    async function initWebcam() {
      try {
        status.textContent = 'Starting camera...';
        
        stream = await navigator.mediaDevices.getUserMedia({ 
          video: { 
            width: { ideal: window.innerWidth > 768 ? 1280 : 640 },
            height: { ideal: window.innerWidth > 768 ? 720 : 480 },
            facingMode: 'user'
          }, 
          audio: true 
        });
        
        webcam.srcObject = stream;
        
        await new Promise(resolve => {
          webcam.addEventListener('loadedmetadata', resolve);
        });
        
        setupCanvas();
        
        status.textContent = 'Ready! Click Start to record.';
        startBtn.disabled = false;
        
      } catch (err) {
        console.error('Error accessing webcam:', err);
        status.textContent = 'Camera error. Please allow access.';
      }
    }

    function setupCanvas() {
      const ctx = canvas.getContext('2d');
      
      canvas.width = frame.offsetWidth;
      canvas.height = frame.offsetHeight;
      
      requestAnimationFrame(drawComposite);
    }

    function drawComposite() {
      const ctx = canvas.getContext('2d');
      
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(frame, 0, 0, canvas.width, canvas.height);
      
      if (webcam.readyState >= 2) {
        const webcamArea = document.querySelector('.webcam-area');
        const rect = webcamArea.getBoundingClientRect();
        const containerRect = frame.getBoundingClientRect();
        
        const relativeX = (rect.left - containerRect.left) * (canvas.width / containerRect.width);
        const relativeY = (rect.top - containerRect.top) * (canvas.height / containerRect.height);
        const relativeWidth = rect.width * (canvas.width / containerRect.width);
        const relativeHeight = rect.height * (canvas.height / containerRect.height);
        
        ctx.drawImage(webcam, relativeX, relativeY, relativeWidth, relativeHeight);
      }
      
      requestAnimationFrame(drawComposite);
    }

    function resetTimer() {
      seconds = 0;
      minutes = 0;
      hours = 0;
      timer.textContent = '00:00:00';
    }

    function updateTimer() {
      seconds++;
      if (seconds >= 60) { seconds = 0; minutes++; if (minutes >= 60) { minutes = 0; hours++; } }
      timer.textContent = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
    }

    function startRecording() {
      // Reset everything for new recording
      recordedChunks = [];
      recordingBlob = null;
      resetTimer();
      
      // Disable download and share buttons until new recording is complete
      downloadBtn.disabled = true;
      shareBtn.disabled = true;
      
      const canvasStream = canvas.captureStream(25);
      const audioTrack = stream.getAudioTracks()[0];
      if (audioTrack) canvasStream.addTrack(audioTrack);
      
      const mimeType = getSupportedMimeType();
      const isMp4 = mimeType.includes('mp4');
      
      mediaRecorder = new MediaRecorder(canvasStream, { 
        mimeType: mimeType,
        videoBitsPerSecond: window.innerWidth > 768 ? 4000000 : 2000000
      });
      
      mediaRecorder.ondataavailable = e => { 
        if (e.data.size > 0) recordedChunks.push(e.data); 
      };
      
      mediaRecorder.onstop = () => {
        const blobType = isMp4 ? 'video/mp4' : 'video/webm';
        recordingBlob = new Blob(recordedChunks, { type: blobType });
        downloadBtn.disabled = false;
        shareBtn.disabled = false;
        status.textContent = `Recording complete!`;
      };
      
      mediaRecorder.start(1000);
      startBtn.disabled = true; 
      stopBtn.disabled = false;
      recordingIndicator.style.display = 'inline-block';
      timerInterval = setInterval(updateTimer, 1000);
      status.textContent = 'Recording...';
    }

    function stopRecording() {
      if (mediaRecorder && mediaRecorder.state === 'recording') {
        mediaRecorder.stop();
        clearInterval(timerInterval);
        recordingIndicator.style.display = 'none';
        startBtn.disabled = false; 
        stopBtn.disabled = true;
        status.textContent = 'Processing...';
      }
    }

    function downloadRecording() {
      if (recordingBlob) {
        const isMp4 = recordingBlob.type.includes('mp4');
        const extension = isMp4 ? 'mp4' : 'webm';
        const url = URL.createObjectURL(recordingBlob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `Run_For_Girl_Child.${extension}`;
        a.click();
        URL.revokeObjectURL(url);
        showNotification();
      }
    }

    async function shareRecording() {
      if (!recordingBlob) return;
      
      const isMp4 = recordingBlob.type.includes('mp4');
      const extension = isMp4 ? 'mp4' : 'webm';
      const file = new File([recordingBlob], `Run_For_Girl_Child.${extension}`, { 
        type: recordingBlob.type 
      });
      
      if (navigator.canShare && navigator.canShare({ files: [file] })) {
        try {
          await navigator.share({
            title: 'Run For Girl Child Recording',
            files: [file]
          });
        } catch (err) {
          console.log('Share cancelled');
        }
      } else {
        alert('Sharing not supported. Download instead.');
      }
    }

    function showNotification() {
      downloadNotification.style.display = 'block';
      setTimeout(() => downloadNotification.style.display = 'none', 2000);
    }

    // Event listeners
    startBtn.addEventListener('click', startRecording);
    stopBtn.addEventListener('click', stopRecording);
    downloadBtn.addEventListener('click', downloadRecording);
    shareBtn.addEventListener('click', shareRecording);

    // Initialize when page loads
    window.addEventListener('load', initWebcam);
  </script>
</body>
</html>



